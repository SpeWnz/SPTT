# Sample queries
Some sample queries to use in the nmap db file generated by the <b>nmap2sqlite.py</b> script.

### Web app services

```
select DISTINCT hosts.ip, hosts.hostname, hosts.target_group, ports.port, ports.service_name
from hosts, ports
where hosts.id = ports.host_id
and (ports.service_name like "%http%")
and ports.state = "open"
order by hosts.target_group
```

### Infra services

```
select DISTINCT hosts.ip, hosts.target_group, ports.port, ports.service_name
from hosts, ports
where hosts.id = ports.host_id
and (ports.service_name not like "%http%")
and ports.state = "open"
order by service_name
```


### List target groups

```
select DISTINCT hosts.target_group 
from hosts
```

### For each host, list all open ports separated by comma

```
SELECT DISTINCT h.ip AS host, 
       GROUP_CONCAT(p.port, ',') AS open_ports
FROM hosts h
JOIN ports p ON h.id = p.host_id
WHERE p.state = 'open'
GROUP BY h.id;
```

### List all open ports

```
select DISTINCT ports.port
from ports
where ports.state is 'open'
```


### Hosts with only 1 open port

```
SELECT h.ip, p.port, h.target_group
FROM hosts h
JOIN ports p ON h.id = p.host_id
WHERE h.ports_open = 1 AND p.state = 'open'
```

### Hosts with atleast 3 open ports

```
select hosts.ip as "IP",
CASE hosts.hostname
WHEN NULL then "(no hostname)"
WHEN "" then "(no hostname)"
WHEN " " then "(no hostname)"
ELSE hosts.hostname
END as "Hostname",
hosts.target_group as "Target Group",
count(ports.port) as "Ports"
from hosts join ports on hosts.id = ports.host_id
where (ports.state == "open")
group by (hosts.id)
HAVING "Ports" >= 3
order by "Ports" desc
```



### Pull data from specific IP

```
select * 
from hosts join ports on hosts.id = ports.host_id
where hosts.ip = "10.20.30.40"
and ports.state = "open"
```


### Pull data from specific hostname

```
select * 
from hosts join ports on hosts.id = ports.host_id
where hosts.ip = "10.20.30.40"
and ports.state = "open"
```
